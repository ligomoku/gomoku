import { getNow } from './util';
export class Combo {
    constructor(config) {
        this.config = config;
        this.current = 0;
        this.best = 0;
        this.inc = () => {
            this.current++;
            this.best = Math.max(this.best, this.current);
        };
        this.reset = () => {
            this.current = 0;
        };
        this.level = () => this.config.combo.levels.reduce((lvl, [threshold, _], index) => (threshold <= this.current ? index : lvl), 0);
        this.percent = () => {
            const lvl = this.level();
            const levels = this.config.combo.levels;
            const lastLevel = levels[levels.length - 1];
            if (lvl >= levels.length - 1) {
                const range = lastLevel[0] - levels[levels.length - 2][0];
                return (((this.current - lastLevel[0]) / range) * 100) % 100;
            }
            const bounds = [levels[lvl][0], levels[lvl + 1][0]];
            return Math.floor(((this.current - bounds[0]) / (bounds[1] - bounds[0])) * 100);
        };
        this.bonus = () => {
            if (this.percent() == 0) {
                const level = this.level();
                if (level > 0)
                    return {
                        seconds: this.config.combo.levels[level][1],
                        at: getNow(),
                    };
            }
            return;
        };
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29tYm8uanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi9zcmMvY29tYm8udHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQ0EsT0FBTyxFQUFFLE1BQU0sRUFBRSxNQUFNLFFBQVEsQ0FBQztBQUVoQyxNQUFNLE9BQU8sS0FBSztJQUloQixZQUE0QixNQUFjO1FBQWQsV0FBTSxHQUFOLE1BQU0sQ0FBUTtRQUgxQyxZQUFPLEdBQUcsQ0FBQyxDQUFDO1FBQ1osU0FBSSxHQUFHLENBQUMsQ0FBQztRQUlULFFBQUcsR0FBRyxHQUFHLEVBQUU7WUFDVCxJQUFJLENBQUMsT0FBTyxFQUFFLENBQUM7WUFDZixJQUFJLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUM7UUFDaEQsQ0FBQyxDQUFDO1FBRUYsVUFBSyxHQUFHLEdBQUcsRUFBRTtZQUNYLElBQUksQ0FBQyxPQUFPLEdBQUcsQ0FBQyxDQUFDO1FBQ25CLENBQUMsQ0FBQztRQUVGLFVBQUssR0FBRyxHQUFHLEVBQUUsQ0FDWCxJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsR0FBRyxFQUFFLENBQUMsU0FBUyxFQUFFLENBQUMsQ0FBQyxFQUFFLEtBQUssRUFBRSxFQUFFLENBQUMsQ0FBQyxTQUFTLElBQUksSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztRQUVoSCxZQUFPLEdBQUcsR0FBRyxFQUFFO1lBQ2IsTUFBTSxHQUFHLEdBQUcsSUFBSSxDQUFDLEtBQUssRUFBRSxDQUFDO1lBQ3pCLE1BQU0sTUFBTSxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQztZQUN4QyxNQUFNLFNBQVMsR0FBRyxNQUFNLENBQUMsTUFBTSxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsQ0FBQztZQUM1QyxJQUFJLEdBQUcsSUFBSSxNQUFNLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRTtnQkFDNUIsTUFBTSxLQUFLLEdBQUcsU0FBUyxDQUFDLENBQUMsQ0FBQyxHQUFHLE1BQU0sQ0FBQyxNQUFNLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO2dCQUMxRCxPQUFPLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxPQUFPLEdBQUcsU0FBUyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsS0FBSyxDQUFDLEdBQUcsR0FBRyxDQUFDLEdBQUcsR0FBRyxDQUFDO2FBQzlEO1lBQ0QsTUFBTSxNQUFNLEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsTUFBTSxDQUFDLEdBQUcsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ3BELE9BQU8sSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLE9BQU8sR0FBRyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsR0FBRyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLEdBQUcsQ0FBQyxDQUFDO1FBQ2xGLENBQUMsQ0FBQztRQUVGLFVBQUssR0FBRyxHQUF3QixFQUFFO1lBQ2hDLElBQUksSUFBSSxDQUFDLE9BQU8sRUFBRSxJQUFJLENBQUMsRUFBRTtnQkFDdkIsTUFBTSxLQUFLLEdBQUcsSUFBSSxDQUFDLEtBQUssRUFBRSxDQUFDO2dCQUMzQixJQUFJLEtBQUssR0FBRyxDQUFDO29CQUNYLE9BQU87d0JBQ0wsT0FBTyxFQUFFLElBQUksQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7d0JBQzNDLEVBQUUsRUFBRSxNQUFNLEVBQUU7cUJBQ2IsQ0FBQzthQUNMO1lBQ0QsT0FBTztRQUNULENBQUMsQ0FBQztJQXBDMkMsQ0FBQztDQXFDL0MiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb25maWcsIFRpbWVNb2QgfSBmcm9tICcuL2ludGVyZmFjZXMnO1xuaW1wb3J0IHsgZ2V0Tm93IH0gZnJvbSAnLi91dGlsJztcblxuZXhwb3J0IGNsYXNzIENvbWJvIHtcbiAgY3VycmVudCA9IDA7XG4gIGJlc3QgPSAwO1xuXG4gIHB1YmxpYyBjb25zdHJ1Y3RvcihyZWFkb25seSBjb25maWc6IENvbmZpZykge31cblxuICBpbmMgPSAoKSA9PiB7XG4gICAgdGhpcy5jdXJyZW50Kys7XG4gICAgdGhpcy5iZXN0ID0gTWF0aC5tYXgodGhpcy5iZXN0LCB0aGlzLmN1cnJlbnQpO1xuICB9O1xuXG4gIHJlc2V0ID0gKCkgPT4ge1xuICAgIHRoaXMuY3VycmVudCA9IDA7XG4gIH07XG5cbiAgbGV2ZWwgPSAoKSA9PlxuICAgIHRoaXMuY29uZmlnLmNvbWJvLmxldmVscy5yZWR1Y2UoKGx2bCwgW3RocmVzaG9sZCwgX10sIGluZGV4KSA9PiAodGhyZXNob2xkIDw9IHRoaXMuY3VycmVudCA/IGluZGV4IDogbHZsKSwgMCk7XG5cbiAgcGVyY2VudCA9ICgpID0+IHtcbiAgICBjb25zdCBsdmwgPSB0aGlzLmxldmVsKCk7XG4gICAgY29uc3QgbGV2ZWxzID0gdGhpcy5jb25maWcuY29tYm8ubGV2ZWxzO1xuICAgIGNvbnN0IGxhc3RMZXZlbCA9IGxldmVsc1tsZXZlbHMubGVuZ3RoIC0gMV07XG4gICAgaWYgKGx2bCA+PSBsZXZlbHMubGVuZ3RoIC0gMSkge1xuICAgICAgY29uc3QgcmFuZ2UgPSBsYXN0TGV2ZWxbMF0gLSBsZXZlbHNbbGV2ZWxzLmxlbmd0aCAtIDJdWzBdO1xuICAgICAgcmV0dXJuICgoKHRoaXMuY3VycmVudCAtIGxhc3RMZXZlbFswXSkgLyByYW5nZSkgKiAxMDApICUgMTAwO1xuICAgIH1cbiAgICBjb25zdCBib3VuZHMgPSBbbGV2ZWxzW2x2bF1bMF0sIGxldmVsc1tsdmwgKyAxXVswXV07XG4gICAgcmV0dXJuIE1hdGguZmxvb3IoKCh0aGlzLmN1cnJlbnQgLSBib3VuZHNbMF0pIC8gKGJvdW5kc1sxXSAtIGJvdW5kc1swXSkpICogMTAwKTtcbiAgfTtcblxuICBib251cyA9ICgpOiBUaW1lTW9kIHwgdW5kZWZpbmVkID0+IHtcbiAgICBpZiAodGhpcy5wZXJjZW50KCkgPT0gMCkge1xuICAgICAgY29uc3QgbGV2ZWwgPSB0aGlzLmxldmVsKCk7XG4gICAgICBpZiAobGV2ZWwgPiAwKVxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHNlY29uZHM6IHRoaXMuY29uZmlnLmNvbWJvLmxldmVsc1tsZXZlbF1bMV0sXG4gICAgICAgICAgYXQ6IGdldE5vdygpLFxuICAgICAgICB9O1xuICAgIH1cbiAgICByZXR1cm47XG4gIH07XG59XG4iXX0=