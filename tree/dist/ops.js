export function withMainlineChild(node, f) {
    const next = node.children[0];
    return next ? f(next) : undefined;
}
export function findInMainline(fromNode, predicate) {
    const findFrom = function (node) {
        if (predicate(node))
            return node;
        return withMainlineChild(node, findFrom);
    };
    return findFrom(fromNode);
}
// returns a list of nodes collected from the original one
export function collect(from, pickChild) {
    const nodes = [from];
    let n = from, c;
    while ((c = pickChild(n))) {
        nodes.push(c);
        n = c;
    }
    return nodes;
}
const pickFirstChild = (node) => node.children[0];
export const childById = (node, id) => node.children.find(child => child.id === id);
export const last = (nodeList) => nodeList[nodeList.length - 1];
export const nodeAtPly = (nodeList, ply) => nodeList.find(node => node.ply === ply);
export function takePathWhile(nodeList, predicate) {
    let path = '';
    for (const i in nodeList) {
        if (predicate(nodeList[i]))
            path += nodeList[i].id;
        else
            break;
    }
    return path;
}
export function removeChild(parent, id) {
    parent.children = parent.children.filter(function (n) {
        return n.id !== id;
    });
}
export function countChildrenAndComments(node) {
    const count = {
        nodes: 1,
        comments: (node.comments || []).length,
    };
    node.children.forEach(function (child) {
        const c = countChildrenAndComments(child);
        count.nodes += c.nodes;
        count.comments += c.comments;
    });
    return count;
}
// adds n2 into n1
export function merge(n1, n2) {
    if (n2.eval)
        n1.eval = n2.eval;
    if (n2.glyphs)
        n1.glyphs = n2.glyphs;
    n2.comments &&
        n2.comments.forEach(function (c) {
            if (!n1.comments)
                n1.comments = [c];
            else if (!n1.comments.some(function (d) {
                return d.text === c.text;
            }))
                n1.comments.push(c);
        });
    n2.children.forEach(function (c) {
        const existing = childById(n1, c.id);
        if (existing)
            merge(existing, c);
        else
            n1.children.push(c);
    });
}
export const hasBranching = (node, maxDepth) => maxDepth <= 0 || !!node.children[1] || (node.children[0] && hasBranching(node.children[0], maxDepth - 1));
export const mainlineNodeList = (from) => collect(from, pickFirstChild);
export function updateAll(root, f) {
    // applies f recursively to all nodes
    function update(node) {
        f(node);
        node.children.forEach(update);
    }
    update(root);
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoib3BzLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc3JjL29wcy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxNQUFNLFVBQVUsaUJBQWlCLENBQUksSUFBZSxFQUFFLENBQXlCO0lBQzdFLE1BQU0sSUFBSSxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDOUIsT0FBTyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDO0FBQ3BDLENBQUM7QUFFRCxNQUFNLFVBQVUsY0FBYyxDQUFDLFFBQW1CLEVBQUUsU0FBdUM7SUFDekYsTUFBTSxRQUFRLEdBQUcsVUFBVSxJQUFlO1FBQ3hDLElBQUksU0FBUyxDQUFDLElBQUksQ0FBQztZQUFFLE9BQU8sSUFBSSxDQUFDO1FBQ2pDLE9BQU8saUJBQWlCLENBQUMsSUFBSSxFQUFFLFFBQVEsQ0FBQyxDQUFDO0lBQzNDLENBQUMsQ0FBQztJQUNGLE9BQU8sUUFBUSxDQUFDLFFBQVEsQ0FBQyxDQUFDO0FBQzVCLENBQUM7QUFFRCwwREFBMEQ7QUFDMUQsTUFBTSxVQUFVLE9BQU8sQ0FBQyxJQUFlLEVBQUUsU0FBcUQ7SUFDNUYsTUFBTSxLQUFLLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUNyQixJQUFJLENBQUMsR0FBRyxJQUFJLEVBQ1YsQ0FBQyxDQUFDO0lBQ0osT0FBTyxDQUFDLENBQUMsR0FBRyxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRTtRQUN6QixLQUFLLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ2QsQ0FBQyxHQUFHLENBQUMsQ0FBQztLQUNQO0lBQ0QsT0FBTyxLQUFLLENBQUM7QUFDZixDQUFDO0FBRUQsTUFBTSxjQUFjLEdBQUcsQ0FBQyxJQUFlLEVBQXlCLEVBQUUsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDO0FBRXBGLE1BQU0s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LFNBQVMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBQ3JDLElBQUksUUFBUTtZQUFFLEtBQUssQ0FBQyxRQUFRLEVBQUUsQ0FBQyxDQUFDLENBQUM7O1lBQzVCLEVBQUUsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQzNCLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQztBQUVELE1BQU0sQ0FBQyxNQUFNLFlBQVksR0FBRyxDQUFDLElBQWUsRUFBRSxRQUFnQixFQUFXLEVBQUUsQ0FDekUsUUFBUSxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLElBQUksWUFBWSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLEVBQUUsUUFBUSxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUM7QUFFNUcsTUFBTSxDQUFDLE1BQU0sZ0JBQWdCLEdBQUcsQ0FBQyxJQUFlLEVBQWUsRUFBRSxDQUFDLE9BQU8sQ0FBQyxJQUFJLEVBQUUsY0FBYyxDQUFDLENBQUM7QUFFaEcsTUFBTSxVQUFVLFNBQVMsQ0FBQyxJQUFlLEVBQUUsQ0FBNEI7SUFDckUscUNBQXFDO0lBQ3JDLFNBQVMsTUFBTSxDQUFDLElBQWU7UUFDN0IsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ1IsSUFBSSxDQUFDLFFBQVEsQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUM7SUFDaEMsQ0FBQztJQUNELE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQztBQUNmLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgZnVuY3Rpb24gd2l0aE1haW5saW5lQ2hpbGQ8VD4obm9kZTogVHJlZS5Ob2RlLCBmOiAobm9kZTogVHJlZS5Ob2RlKSA9PiBUKTogVCB8IHVuZGVmaW5lZCB7XG4gIGNvbnN0IG5leHQgPSBub2RlLmNoaWxkcmVuWzBdO1xuICByZXR1cm4gbmV4dCA/IGYobmV4dCkgOiB1bmRlZmluZWQ7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBmaW5kSW5NYWlubGluZShmcm9tTm9kZTogVHJlZS5Ob2RlLCBwcmVkaWNhdGU6IChub2RlOiBUcmVlLk5vZGUpID0+IGJvb2xlYW4pOiBUcmVlLk5vZGUgfCB1bmRlZmluZWQge1xuICBjb25zdCBmaW5kRnJvbSA9IGZ1bmN0aW9uIChub2RlOiBUcmVlLk5vZGUpOiBUcmVlLk5vZGUgfCB1bmRlZmluZWQge1xuICAgIGlmIChwcmVkaWNhdGUobm9kZSkpIHJldHVybiBub2RlO1xuICAgIHJldHVybiB3aXRoTWFpbmxpbmVDaGlsZChub2RlLCBmaW5kRnJvbSk7XG4gIH07XG4gIHJldHVybiBmaW5kRnJvbShmcm9tTm9kZSk7XG59XG5cbi8vIHJldHVybnMgYSBsaXN0IG9mIG5vZGVzIGNvbGxlY3RlZCBmcm9tIHRoZSBvcmlnaW5hbCBvbmVcbmV4cG9ydCBmdW5jdGlvbiBjb2xsZWN0KGZyb206IFRyZWUuTm9kZSwgcGlja0NoaWxkOiAobm9kZTogVHJlZS5Ob2RlKSA9PiBUcmVlLk5vZGUgfCB1bmRlZmluZWQpOiBUcmVlLk5vZGVbXSB7XG4gIGNvbnN0IG5vZGVzID0gW2Zyb21dO1xuICBsZXQgbiA9IGZyb20sXG4gICAgYztcbiAgd2hpbGUgKChjID0gcGlja0NoaWxkKG4pKSkge1xuICAgIG5vZGVzLnB1c2goYyk7XG4gICAgbiA9IGM7XG4gIH1cbiAgcmV0dXJuIG5vZGVzO1xufVxuXG5jb25zdCBwaWNrRmlyc3RDaGlsZCA9IChub2RlOiBUcmVlLk5vZGUpOiBUcmVlLk5vZGUgfCB1bmRlZmluZWQgPT4gbm9kZS5jaGlsZHJlblswXTtcblxuZXhwb3J0IGNvbnN0IGNoaWxkQnlJZCA9IChub2RlOiBUcmVlLk5vZGUsIGlkOiBzdHJpbmcpOiBUcmVlLk5vZGUgfCB1bmRlZmluZWQgPT5cbiAgbm9kZS5jaGlsZHJlbi5maW5kKGNoaWxkID0+IGNoaWxkLmlkID09PSBpZCk7XG5cbmV4cG9ydCBjb25zdCBsYXN0ID0gKG5vZGVMaXN0OiBUcmVlLk5vZGVbXSk6IFRyZWUuTm9kZSB8IHVuZGVmaW5lZCA9PiBub2RlTGlzdFtub2RlTGlzdC5sZW5ndGggLSAxXTtcblxuZXhwb3J0IGNvbnN0IG5vZGVBdFBseSA9IChub2RlTGlzdDogVHJlZS5Ob2RlW10sIHBseTogbnVtYmVyKTogVHJlZS5Ob2RlIHwgdW5kZWZpbmVkID0+XG4gIG5vZGVMaXN0LmZpbmQobm9kZSA9PiBub2RlLnBseSA9PT0gcGx5KTtcblxuZXhwb3J0IGZ1bmN0aW9uIHRha2VQYXRoV2hpbGUobm9kZUxpc3Q6IFRyZWUuTm9kZVtdLCBwcmVkaWNhdGU6IChub2RlOiBUcmVlLk5vZGUpID0+IGJvb2xlYW4pOiBUcmVlLlBhdGgge1xuICBsZXQgcGF0aCA9ICcnO1xuICBmb3IgKGNvbnN0IGkgaW4gbm9kZUxpc3QpIHtcbiAgICBpZiAocHJlZGljYXRlKG5vZGVMaXN0W2ldKSkgcGF0aCArPSBub2RlTGlzdFtpXS5pZDtcbiAgICBlbHNlIGJyZWFrO1xuICB9XG4gIHJldHVybiBwYXRoO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gcmVtb3ZlQ2hpbGQocGFyZW50OiBUcmVlLk5vZGUsIGlkOiBzdHJpbmcpOiB2b2lkIHtcbiAgcGFyZW50LmNoaWxkcmVuID0gcGFyZW50LmNoaWxkcmVuLmZpbHRlcihmdW5jdGlvbiAobikge1xuICAgIHJldHVybiBuLmlkICE9PSBpZDtcbiAgfSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBjb3VudENoaWxkcmVuQW5kQ29tbWVudHMobm9kZTogVHJlZS5Ob2RlKSB7XG4gIGNvbnN0IGNvdW50ID0ge1xuICAgIG5vZGVzOiAxLFxuICAgIGNvbW1lbnRzOiAobm9kZS5jb21tZW50cyB8fCBbXSkubGVuZ3RoLFxuICB9O1xuICBub2RlLmNoaWxkcmVuLmZvckVhY2goZnVuY3Rpb24gKGNoaWxkKSB7XG4gICAgY29uc3QgYyA9IGNvdW50Q2hpbGRyZW5BbmRDb21tZW50cyhjaGlsZCk7XG4gICAgY291bnQubm9kZXMgKz0gYy5ub2RlcztcbiAgICBjb3VudC5jb21tZW50cyArPSBjLmNvbW1lbnRzO1xuICB9KTtcbiAgcmV0dXJuIGNvdW50O1xufVxuXG4vLyBhZGRzIG4yIGludG8gbjFcbmV4cG9ydCBmdW5jdGlvbiBtZXJnZShuMTogVHJlZS5Ob2RlLCBuMjogVHJlZS5Ob2RlKTogdm9pZCB7XG4gIGlmIChuMi5ldmFsKSBuMS5ldmFsID0gbjIuZXZhbDtcbiAgaWYgKG4yLmdseXBocykgbjEuZ2x5cGhzID0gbjIuZ2x5cGhzO1xuICBuMi5jb21tZW50cyAmJlxuICAgIG4yLmNvbW1lbnRzLmZvckVhY2goZnVuY3Rpb24gKGMpIHtcbiAgICAgIGlmICghbjEuY29tbWVudHMpIG4xLmNvbW1lbnRzID0gW2NdO1xuICAgICAgZWxzZSBpZiAoXG4gICAgICAgICFuMS5jb21tZW50cy5zb21lKGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgcmV0dXJuIGQudGV4dCA9PT0gYy50ZXh0O1xuICAgICAgICB9KVxuICAgICAgKVxuICAgICAgICBuMS5jb21tZW50cy5wdXNoKGMpO1xuICAgIH0pO1xuICBuMi5jaGlsZHJlbi5mb3JFYWNoKGZ1bmN0aW9uIChjKSB7XG4gICAgY29uc3QgZXhpc3RpbmcgPSBjaGlsZEJ5SWQobjEsIGMuaWQpO1xuICAgIGlmIChleGlzdGluZykgbWVyZ2UoZXhpc3RpbmcsIGMpO1xuICAgIGVsc2UgbjEuY2hpbGRyZW4ucHVzaChjKTtcbiAgfSk7XG59XG5cbmV4cG9ydCBjb25zdCBoYXNCcmFuY2hpbmcgPSAobm9kZTogVHJlZS5Ob2RlLCBtYXhEZXB0aDogbnVtYmVyKTogYm9vbGVhbiA9PlxuICBtYXhEZXB0aCA8PSAwIHx8ICEhbm9kZS5jaGlsZHJlblsxXSB8fCAobm9kZS5jaGlsZHJlblswXSAmJiBoYXNCcmFuY2hpbmcobm9kZS5jaGlsZHJlblswXSwgbWF4RGVwdGggLSAxKSk7XG5cbmV4cG9ydCBjb25zdCBtYWlubGluZU5vZGVMaXN0ID0gKGZyb206IFRyZWUuTm9kZSk6IFRyZWUuTm9kZVtdID0+IGNvbGxlY3QoZnJvbSwgcGlja0ZpcnN0Q2hpbGQpO1xuXG5leHBvcnQgZnVuY3Rpb24gdXBkYXRlQWxsKHJvb3Q6IFRyZWUuTm9kZSwgZjogKG5vZGU6IFRyZWUuTm9kZSkgPT4gdm9pZCk6IHZvaWQge1xuICAvLyBhcHBsaWVzIGYgcmVjdXJzaXZlbHkgdG8gYWxsIG5vZGVzXG4gIGZ1bmN0aW9uIHVwZGF0ZShub2RlOiBUcmVlLk5vZGUpIHtcbiAgICBmKG5vZGUpO1xuICAgIG5vZGUuY2hpbGRyZW4uZm9yRWFjaCh1cGRhdGUpO1xuICB9XG4gIHVwZGF0ZShyb290KTtcbn1cbiJdfQ==