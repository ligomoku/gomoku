import * as enhance from 'common/richText';
import userLink from 'common/userLink';
import * as spam from './spam';
import { h, thunk } from 'snabbdom';
import { lineAction as modLineAction, report } from './moderation';
import { presetView } from './preset';
const whisperRegex = /^\/[wW](?:hisper)?\s/;
export default function (ctrl) {
    if (!ctrl.vm.enabled)
        return [];
    const scrollCb = (vnode) => {
        const el = vnode.elm;
        if (ctrl.data.lines.length > 5) {
            const autoScroll = el.scrollTop === 0 || el.scrollTop > el.scrollHeight - el.clientHeight - 100;
            if (autoScroll) {
                el.scrollTop = 999999;
                setTimeout((_) => (el.scrollTop = 999999), 300);
            }
        }
    }, hasMod = !!ctrl.moderation();
    const vnodes = [
        h(`ol.mchat__messages.chat-v-${ctrl.data.domVersion}${hasMod ? '.as-mod' : ''}`, {
            attrs: {
                role: 'log',
                'aria-live': 'polite',
                'aria-atomic': 'false',
            },
            hook: {
                insert(vnode) {
                    const $el = $(vnode.elm).on('click', 'a.jump', (e) => {
                        lichess.pubsub.emit('jump', e.target.getAttribute('data-ply'));
                    });
                    if (hasMod)
                        $el.on('click', '.mod', (e) => { var _a; return (_a = ctrl.moderation()) === null || _a === void 0 ? void 0 : _a.open(e.target.parentNode); });
                    else
                        $el.on('click', '.flag', (e) => report(ctrl, e.target.parentNode));
                    scrollCb(vnode);
                },
                postpatch: (_, vnode) => scrollCb(vnode),
            },
        }, selectLines(ctrl).map(line => renderLine(ctrl, line))),
        renderInput(ctrl),
    ];
    const presets = presetView(ctrl.preset);
    if (presets)
        vnodes.push(presets);
    return vnodes;
}
function renderInput(ctrl) {
    if (!ctrl.vm.writeable)
        return;
    if ((ctrl.data.loginRequired && !ctrl.data.userId) || ctrl.data.restricted)
        return h('input.mchat__say', {
            attrs: {
                placeholder: ctrl.trans('loginToChat'),
                disabled: true,
            },
        });
    let placeholder;
    if (ctrl.vm.timeout)
        placeholder = ctrl.trans('youHaveBeenTimedOut');
    else if (ctrl.opts.blind)
        placeholder = 'Chat';
    else
        placeholder = ctrl.trans.noarg(ctrl.vm.placeholderKey);
    return h('input.mchat__say', {
        attrs: {
            placeholder,
            autocomplete: 'off',
            enterkeyhint: 'send',
            maxlength: 140,
            disabled: ctrl.vm.timeout || !ctrl.vm.writeable,
            'aria-label': 'Chat input',
        },
        hook: {
            insert(vnode) {
                setupHooks(ctrl, vnode.elm);
            },
        },
    });
}
let mouchListener;
const setupHooks = (ctrl, chatEl) => {
    const storage = lichess.tempStorage.make('chat.input');
    const previousText = storage.get();
    if (previousText) {
        chatEl.value = previousText;
        chatEl.focus();
        if (!ctrl.opts.public && previousText.match(whisperRegex))
            chatEl.classList.add('whisper');
    }
    else if (ctrl.vm.autofocus)
        chatEl.focus();
    chatEl.addEventListener('keydown', (e) => {
        if (e.key !== 'Enter')
            return;
        setTimeout(() => {
            const el = e.target, txt = el.value, pub = ctrl.opts.public;
            if (txt === '')
                $('.keyboard-move input').each(function () {
                    this.focus();
                });
            else {
                if (!ctrl.opts.kobold)
                    spam.selfReport(txt);
                if (pub && spam.hasTeamUrl(txt))
                    alert("Please don't advertise teams in the chat.");
                else
                    ctrl.post(txt);
                el.value = '';
                storage.remove();
                if (!pub)
                    el.classList.remove('whisper');
            }
        });
    });
    chatEl.addEventListener('input', (e) => setTimeout(() => {
        const el = e.target, txt = el.value;
        el.removeAttribute('placeholder');
        if (!ctrl.opts.public)
            el.classList.toggle('whisper', !!txt.match(whisperRegex));
        storage.set(txt);
    }));
    window.Mousetrap.bind('c', () => chatEl.focus());
    // Ensure clicks remove chat focus.
    // See lichess-org/chessground#109
    const mouchEvents = ['touchstart', 'mousedown'];
    if (mouchListener)
        mouchEvents.forEach(event => document.body.removeEventListener(event, mouchListener, { capture: true }));
    mouchListener = (e) => {
        if (!e.shiftKey && e.buttons !== 2 && e.button !== 2)
            chatEl.blur();
    };
    chatEl.onfocus = () => mouchEvents.forEach(event => document.body.addEventListener(event, mouchListener, { passive: true, capture: true }));
    chatEl.onblur = () => mouchEvents.forEach(event => document.body.removeEventListener(event, mouchListener, { capture: true }));
};
const sameLines = (l1, l2) => l1.d && l2.d && l1.u === l2.u;
function selectLines(ctrl) {
    const ls = [];
    let prev;
    ctrl.data.lines.forEach(line => {
        if (!line.d &&
            (!prev || !sameLines(prev, line)) &&
            (!line.r || (line.u || '').toLowerCase() == ctrl.data.userId) &&
            !spam.skip(line.t))
            ls.push(line);
        prev = line;
    });
    return ls;
}
function updateText(parseMoves) {
    return (oldVnode, vnode) => {
        if (vnode.data.lichessChat !== oldVnode.data.lichessChat) {
            vnode.elm.innerHTML = enhance.enhance(vnode.data.lichessChat, parseMoves);
        }
    };
}
function renderText(t, parseMoves) {
    if (enhance.isMoreThanText(t)) {
        const hook = updateText(parseMoves);
        return h('t', {
            lichessChat: t,
            hook: {
                create: hook,
                update: hook,
            },
        });
    }
    return h('t', t);
}
function renderLine(ctrl, line) {
    var _a, _b;
    const textNode = renderText(line.t, ctrl.opts.parseMoves);
    if (line.u === 'lichess')
        return h('li.system', textNode);
    if (line.c)
        return h('li', [h('span.color', '[' + line.c + ']'), textNode]);
    const userNode = thunk('a', line.u, userLink, [line.u, line.title, line.p]);
    const userId = (_a = line.u) === null || _a === void 0 ? void 0 : _a.toLowerCase();
    const myUserId = ctrl.data.userId;
    const mentioned = !!myUserId &&
        !!((_b = line.t.match(enhance.userPattern)) === null || _b === void 0 ? void 0 : _b.find(mention => mention.trim().toLowerCase() == `@${ctrl.data.userId}`));
    return h('li', {
        class: {
            me: userId === myUserId,
            host: userId === ctrl.data.hostId,
            mentioned,
        },
    }, ctrl.moderation()
        ? [line.u ? modLineAction() : null, userNode, ' ', textNode]
        : [
            myUserId && line.u && myUserId != line.u
                ? h('i.flag', {
                    attrs: {
                        'data-icon': 'î€•',
                        title: 'Report',
                    },
                })
                : null,
            userNode,
            ' ',
            textNode,
        ]);
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGlzY3Vzc2lvbi5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uL3NyYy9kaXNjdXNzaW9uLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sS0FBSyxPQUFPLE1BQU0saUJBQWlCLENBQUM7QUFDM0MsT0FBTyxRQUFRLE1BQU0saUJBQWlCLENBQUM7QUFDdkMsT0FBTyxLQUFLLElBQUksTUFBTSxRQUFRLENBQUM7QUFFL0IsT0FBTyxFQUFFLENBQUMsRUFBRSxLQUFLLEVBQW9CLE1BQU0sVUFBVSxDQUFDO0FBQ3RELE9BQU8sRUFBRSxVQUFVLElBQUksYUFBYSxFQUFFLE1BQU0sRUFBRSxNQUFNLGNBQWMsQ0FBQztBQUNuRSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sVUFBVSxDQUFDO0FBRXRDLE1BQU0sWUFBWSxHQUFHLHNCQUFzQixDQUFDO0FBRTVDLE1BQU0sQ0FBQyxPQUFPLFdBQVcsSUFBVTtJQUNqQyxJQUFJLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxPQUFPO1FBQUUsT0FBTyxFQUFFLENBQUM7SUFDaEMsTUFBTSxRQUFRLEdBQUcsQ0FBQyxLQUFZLEVBQUUsRUFBRTtRQUM5QixNQUFNLEVBQUUsR0FBRyxLQUFLLENBQUMsR0FBa0IsQ0FBQztRQUNwQyxJQUFJLElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUU7WUFDOUIsTUFBTSxVQUFVLEdBQUcsRUFBRSxDQUFDLFNBQVMsS0FBSyxDQUFDLElBQUksRUFBRSxDQUFDLFNBQVMsR0FBRyxFQUFFLENBQUMsWUFBWSxHQUFHLEVBQUUsQ0FBQyxZQUFZLEdBQUcsR0FBRyxDQUFDO1lBQ2hHLElBQUksVUFBVSxFQUFFO2dCQUNkLEVBQUUsQ0FBQyxTQUFTLEdBQUcsTUFBTSxDQUFDO2dCQUN0QixVQUFVLENBQUMsQ0FBQyxDQUFNLEVBQUUsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLFNBQVMsR0FBRyxNQUFNLENBQUMsRUFBRSxH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