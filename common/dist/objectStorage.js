const registration = {
    version: 1,
    name: 'lichess',
    stores: ['analyse-state'],
};
export async function objectStorage(storeName) {
    const name = storeName;
    const db = await dbAsync;
    const get = (key) => {
        const store = db.transaction(name, 'readonly').objectStore(name);
        return actionPromise(store.get.bind(store, key));
    };
    const put = (key, value) => {
        const store = db.transaction(name, 'readwrite').objectStore(name);
        return actionPromise(store.put.bind(store, value, key));
    };
    const remove = (key) => {
        const store = db.transaction(name, 'readwrite').objectStore(name);
        return actionPromise(store.delete.bind(store, key));
    };
    const clear = () => {
        const store = db.transaction(name, 'readwrite').objectStore(name);
        return actionPromise(store.clear.bind(store));
    };
    const list = () => new Promise((resolveOp, _) => {
        resolveOp([]); // TODO
    });
    const actionPromise = (f) => new Promise((resolve, reject) => {
        const res = f();
        res.onsuccess = (e) => resolve(e.target.result);
        res.onerror = (e) => reject(e.target.result);
    });
    return {
        get,
        put,
        remove,
        clear,
        list,
    };
}
const dbAsync = new Promise((resolve, reject) => {
    const result = window.indexedDB.open(registration.name, registration.version);
    result.onsuccess = (e) => resolve(e.target.result);
    result.onerror = (e) => reject(e.target.result);
    /*
    This obviously does not handle upgrades to specific object store versions.
    We can add a mechanism where calling code can register an upgrade hook to get
    db and store object as parameters on upgrade event, otherwise the below will
    get messy quick. again, idb object stores can only be non-trivially upgraded
    within a version upgrade event context.
  */
    result.onupgradeneeded = function (ev) {
        const db = ev.target.result;
        const previousStores = Array.from(db.objectStoreNames);
        // const deletes = previousStores.filter(x => !registration.stores.includes(x));
        // const creates = registration.stores.filter(x => !previousStores.includes(x));
        // just blow everything away for now
        previousStores.forEach(x => db.deleteObjectStore(x));
        registration.stores.forEach(x => db.createObjectStore(x));
    };
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoib2JqZWN0U3RvcmFnZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uL3NyYy9vYmplY3RTdG9yYWdlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE1BQU0sWUFBWSxHQUFHO0lBQ25CLE9BQU8sRUFBRSxDQUFDO0lBQ1YsSUFBSSxFQUFFLFNBQVM7SUFDZixNQUFNLEVBQUUsQ0FBQyxlQUFlLENBQUM7Q0FDMUIsQ0FBQztBQXVCRixNQUFNLENBQUMsS0FBSyxVQUFVLGFBQWEsQ0FBSSxTQUFpQjtJQUN0RCxNQUFNLElBQUksR0FBRyxTQUFTLENBQUM7SUFDdkIsTUFBTSxFQUFFLEdBQUcsTUFBTSxPQUFPLENBQUM7SUFFekIsTUFBTSxHQUFHLEdBQUcsQ0FBQyxHQUFXLEVBQUUsRUFBRTtRQUMxQixNQUFNLEtBQUssR0FBRyxFQUFFLENBQUMsV0FBVyxDQUFDLElBQUksRUFBRSxVQUFVLENBQUMsQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDakUsT0FBTyxhQUFhLENBQUksS0FBSyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsS0FBSyxFQUFFLEdBQUcsQ0FBQyxDQUFDLENBQUM7SUFDdEQsQ0FBQyxDQUFDO0lBRUYsTUFBTSxHQUFHLEdBQUcsQ0FBQyxHQUFXLEVBQUUsS0FBUSxFQUFFLEVBQUU7UUFDcEMsTUFBTSxLQUFLLEdBQUcsRUFBRSxDQUFDLFdBQVcsQ0FBQyxJQUFJLEVBQUUsV0FBVyxDQUFDLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ2xFLE9BQU8sYUFBYSxDQUFTLEtBQUssQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLEtBQUssRUFBRSxLQUFLLEVBQUUsR0FBRyxDQUFDLENBQUMsQ0FBQztJQUNsRSxDQUFDLENBQUM7SUFFRixNQUFNLE1BQU0sR0FBRyxDQUFDLEdBQVcsRUFBRSxFQUFFO1FBQzdCLE1BQU0sS0FBSyxHQUFHLEVBQUUsQ0FBQyxXQUFXLENBQUMsSUFBSSxFQUFFLFdBQVcsQ0FBQyxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUNsRSxPQUFPLGFBQWEsQ0FBTyxLQUFLLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxLQUFLLEVBQUUsR0FBRyxDQUFDLENBQUMsQ0FBQztJQUM1RCxDQUFDLENBQUM7SUFFRixNQUFNLEtBQUssR0FBRyxHQUFHLEVBQUU7UUFDakIsTUFBTSxLQUFLLEdBQUcsRUFBRSxDQUFDLFdBQVcsQ0FBQyxJQUFJLEVBQUUsV0FBVyxDQUFDLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ2xFLE9BQU8sYUFBYSxDQUFPLEtBQUssQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7SUFDdEQsQ0FBQyxDQUFDO0lBRUYsTUFBTSxJQUFJLEdBQUcsR0FBRyxFQUFFLENBQ2hCLElBQUksT0FBTyxDQUFXLENBQUMsU0FBUyxFQUFFLENBQUMsRUFBRSxFQUFFO1FBQ3JDLFNBQVMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLE9BQU87SUFDeEIsQ0FBQyxDQUFDLENBQUM7SUFFTCxNQUFNLGFBQWEsR0FBRyxDQUFJLENBQW1CLEVBQUUsRUFBRSxDQUMvQyxJQUFJLE9BQU8sQ0FBSSxDQUFDLE9BQU8sRUFBRSxNQUFNLEVBQUUsRUFBRTtRQUNqQyxNQUFNLEdBQUcsR0FBRyxDQUFDLEVBQUUsQ0FBQztRQUNoQixHQUFHLENBQUMsU0FBUyxHQUFHLENBQUMsQ0FBUSxFQUFFLEVBQUUsQ0FBQyxPQUFPLENBQUUsQ0FBQyxDQUFDLE1BQXFCLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDdkUsR0FBRyxDQUFDLE9BQU8sR0FBRyxDQUFDLENBQVEsRUFBRSxFQUFFLENBQUMsTUFBTSxDQUFFLENBQUMsQ0FBQyxNQUFxQixDQUFDLE1BQU0sQ0FBQyxDQUFDO0lBQ3RFLENBQUMsQ0FBQyxDQUFDO0lBRUwsT0FBTztRQUNMLEdBQUc7UUFDSCxHQUFHO1FBQ0gsTUFBTTtRQUNOLEtBQUs7UUFDTCxJQUFJO0tBQ0wsQ0FBQztBQUNKLENBQUM7QUFFRCxNQUFNLE9BQU8sR0FBRyxJQUFJLE9BQU8sQ0FBYyxDQUFDLE9BQU8sRUFBRSxNQUFNLEVBQUUsRUFBRTtJQUMzRCxNQUFNLE1BQU0sR0FBRyxNQUFNLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsSUFBSSxFQUFFLFlBQVksQ0FBQyxPQUFPLENBQUMsQ0FBQztJQUM5RSxNQUFNLENBQUMsU0FBUyxHQUFHLENBQUMsQ0FBUSxFQUFFLEVBQUUsQ0FBQyxPQUFPLENBQUUsQ0FBQyxDQUFDLE1BQTJCLENBQUMsTUFBTSxDQUFDLENBQUM7SUFDaEYsTUFBTSxDQUFDLE9BQU8sR0FBRyxDQUFDLENBQVEsRUFBRSxFQUFFLENBQUMsTUFBTSxDQUFFLENBQUMsQ0FBQyxNQUEyQixDQUFDLE1BQU0sQ0FBQyxDQUFDO0lBRTdFOzs7Ozs7SUFNQTtJQUNBLE1BQU0sQ0FBQyxlQUFlLEdBQUcsVUFBVSxFQUF5QjtRQUMxRCxNQUFNLEVBQUUsR0FBSSxFQUFFLENBQUMsTUFBMkIsQ0FBQyxNQUFNLENBQUM7UUFDbEQsTUFBTSxjQUFjLEdBQUcsS0FBSyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsZ0JBQWdCLENBQUMsQ0FBQztRQUV2RCxnRkFBZ0Y7UUFDaEYsZ0ZBQWdGO1FBQ2hGLG9DQUFvQztRQUNwQyxjQUFjLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLGlCQUFpQixDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDckQsWUFBWSxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsaUJBQWlCLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUM1RCxDQUFDLENBQUM7QUFDSixDQUFDLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImNvbnN0IHJlZ2lzdHJhdGlvbiA9IHtcbiAgdmVyc2lvbjogMSxcbiAgbmFtZTogJ2xpY2hlc3MnLFxuICBzdG9yZXM6IFsnYW5hbHlzZS1zdGF0ZSddLFxufTtcblxuLyogXG5UbyBhZGQgYSBuZXcgb2JqZWN0IHN0b3JlIHRvIGJyb3dzZXIgZGF0YWJhc2VzLCBhZGQgdGhlIHN0b3JlIG5hbWUgdG9cbnJlZ2lzdHJhdGlvbi5zdG9yZXMgYWJvdmUgYW5kIHRoZW4gYnVtcCByZWdpc3RyYXRpb24udmVyc2lvbiBvdGhlcndpc2UgaXQgd2lsbFxubm90IGJlIGNyZWF0ZWQuICB0aGF0J3MgbmVjZXNzYXJ5IGJlY2F1c2UgbmV3IG9iamVjdCBzdG9yZXMgY2FuIG9ubHkgYmUgY3JlYXRlZFxuZHVyaW5nIGFuIFwidXBncmFkZVwiIGV2ZW50IGlzc3VlZCB3aGVuIHRoZSBkYXRhYmFzZSBpcyBvcGVuZWQsIHNlZSBib3R0b20gb2YgZmlsZS5cblxuTWF5YmUgaW4gdGhlIGZ1dHVyZSB3ZSBjaGVjayBuZXcgc3RvcmUgcmVxdWVzdHMgYWdhaW5zdCB0aGVcbmN1cnJlbnRseSBvcGVuIGNvbm5lY3Rpb24ncyBsaXN0IG9mIHN0b3JlcywgYW5kIGlmIGl0J3Mgbm90IHRoZXJlLCBidW1wIHRoZSBcbnZlcnNpb24gbnVtYmVyIGFuZCByZW9wZW4gdGhlIGNvbm5lY3Rpb24gd2hpY2ggdHJpZ2dlcnMgdGhlIGV2ZW50IHdoZXJlIHdlIGNhblxuY3JlYXRlIHRoZSBuZXcgc3RvcmUuICBUaGF0J3MgVE9ETywgZm9yIG5vdyBqdXN0IGhhcmQgY29kZSBzdG9yZSBuYW1lcyBtYW51YWxseVxuaW4gdGhlIGFib3ZlIHJlZ2lzdHJhdGlvbiBvYmplY3QgYmVmb3JlIHJlcXVlc3RpbmcgdGhlbSBmcm9tIG91dHNpZGUgY29kZS5cbiovXG5cbmV4cG9ydCBpbnRlcmZhY2UgT2JqZWN0U3RvcmFnZTxWPiB7XG4gIGdldChrZXk6IHN0cmluZyk6IFByb21pc2U8Vj47XG4gIHB1dChrZXk6IHN0cmluZywgdmFsdWU6IFYpOiBQcm9taXNlPHN0cmluZz47IC8vIHJldHVybnMga2V5XG4gIHJlbW92ZShrZXk6IHN0cmluZyk6IFByb21pc2U8dm9pZD47IC8vIGRlbGV0ZSBvbmVcbiAgY2xlYXIoKTogUHJvbWlzZTx2b2lkPjsgLy8gZGVsZXRlIGFsbFxuICBsaXN0KCk6IFByb21pc2U8c3RyaW5nW10+O1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gb2JqZWN0U3RvcmFnZTxWPihzdG9yZU5hbWU6IHN0cmluZyk6IFByb21pc2U8T2JqZWN0U3RvcmFnZTxWPj4ge1xuICBjb25zdCBuYW1lID0gc3RvcmVOYW1lO1xuICBjb25zdCBkYiA9IGF3YWl0IGRiQXN5bmM7XG5cbiAgY29uc3QgZ2V0ID0gKGtleTogc3RyaW5nKSA9PiB7XG4gICAgY29uc3Qgc3RvcmUgPSBkYi50cmFuc2FjdGlvbihuYW1lLCAncmVhZG9ubHknKS5vYmplY3RTdG9yZShuYW1lKTtcbiAgICByZXR1cm4gYWN0aW9uUHJvbWlzZTxWPihzdG9yZS5nZXQuYmluZChzdG9yZSwga2V5KSk7XG4gIH07XG5cbiAgY29uc3QgcHV0ID0gKGtleTogc3RyaW5nLCB2YWx1ZTogVikgPT4ge1xuICAgIGNvbnN0IHN0b3JlID0gZGIudHJhbnNhY3Rpb24obmFtZSwgJ3JlYWR3cml0ZScpLm9iamVjdFN0b3JlKG5hbWUpO1xuICAgIHJldHVybiBhY3Rpb25Qcm9taXNlPHN0cmluZz4oc3RvcmUucHV0LmJpbmQoc3RvcmUsIHZhbHVlLCBrZXkpKTtcbiAgfTtcblxuICBjb25zdCByZW1vdmUgPSAoa2V5OiBzdHJpbmcpID0+IHtcbiAgICBjb25zdCBzdG9yZSA9IGRiLnRyYW5zYWN0aW9uKG5hbWUsICdyZWFkd3JpdGUnKS5vYmplY3RTdG9yZShuYW1lKTtcbiAgICByZXR1cm4gYWN0aW9uUHJvbWlzZTx2b2lkPihzdG9yZS5kZWxldGUuYmluZChzdG9yZSwga2V5KSk7XG4gIH07XG5cbiAgY29uc3QgY2xlYXIgPSAoKSA9PiB7XG4gICAgY29uc3Qgc3RvcmUgPSBkYi50cmFuc2FjdGlvbihuYW1lLCAncmVhZHdyaXRlJykub2JqZWN0U3RvcmUobmFtZSk7XG4gICAgcmV0dXJuIGFjdGlvblByb21pc2U8dm9pZD4oc3RvcmUuY2xlYXIuYmluZChzdG9yZSkpO1xuICB9O1xuXG4gIGNvbnN0IGxpc3QgPSAoKSA9PlxuICAgIG5ldyBQcm9taXNlPHN0cmluZ1tdPigocmVzb2x2ZU9wLCBfKSA9PiB7XG4gICAgICByZXNvbHZlT3AoW10pOyAvLyBUT0RPXG4gICAgfSk7XG5cbiAgY29uc3QgYWN0aW9uUHJvbWlzZSA9IDxWPihmOiAoKSA9PiBJREJSZXF1ZXN0KSA9PlxuICAgIG5ldyBQcm9taXNlPFY+KChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgIGNvbnN0IHJlcyA9IGYoKTtcbiAgICAgIHJlcy5vbnN1Y2Nlc3MgPSAoZTogRXZlbnQpID0+IHJlc29sdmUoKGUudGFyZ2V0IGFzIElEQlJlcXVlc3QpLnJlc3VsdCk7XG4gICAgICByZXMub25lcnJvciA9IChlOiBFdmVudCkgPT4gcmVqZWN0KChlLnRhcmdldCBhcyBJREJSZXF1ZXN0KS5yZXN1bHQpO1xuICAgIH0pO1xuXG4gIHJldHVybiB7XG4gICAgZ2V0LFxuICAgIHB1dCxcbiAgICByZW1vdmUsXG4gICAgY2xlYXIsXG4gICAgbGlzdCxcbiAgfTtcbn1cblxuY29uc3QgZGJBc3luYyA9IG5ldyBQcm9taXNlPElEQkRhdGFiYXNlPigocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gIGNvbnN0IHJlc3VsdCA9IHdpbmRvdy5pbmRleGVkREIub3BlbihyZWdpc3RyYXRpb24ubmFtZSwgcmVnaXN0cmF0aW9uLnZlcnNpb24pO1xuICByZXN1bHQub25zdWNjZXNzID0gKGU6IEV2ZW50KSA9PiByZXNvbHZlKChlLnRhcmdldCBhcyBJREJPcGVuREJSZXF1ZXN0KS5yZXN1bHQpO1xuICByZXN1bHQub25lcnJvciA9IChlOiBFdmVudCkgPT4gcmVqZWN0KChlLnRhcmdldCBhcyBJREJPcGVuREJSZXF1ZXN0KS5yZXN1bHQpO1xuXG4gIC8qIFxuICBUaGlzIG9idmlvdXNseSBkb2VzIG5vdCBoYW5kbGUgdXBncmFkZXMgdG8gc3BlY2lmaWMgb2JqZWN0IHN0b3JlIHZlcnNpb25zLlxuICBXZSBjYW4gYWRkIGEgbWVjaGFuaXNtIHdoZXJlIGNhbGxpbmcgY29kZSBjYW4gcmVnaXN0ZXIgYW4gdXBncmFkZSBob29rIHRvIGdldFxuICBkYiBhbmQgc3RvcmUgb2JqZWN0IGFzIHBhcmFtZXRlcnMgb24gdXBncmFkZSBldmVudCwgb3RoZXJ3aXNlIHRoZSBiZWxvdyB3aWxsXG4gIGdldCBtZXNzeSBxdWljay4gYWdhaW4sIGlkYiBvYmplY3Qgc3RvcmVzIGNhbiBvbmx5IGJlIG5vbi10cml2aWFsbHkgdXBncmFkZWRcbiAgd2l0aGluIGEgdmVyc2lvbiB1cGdyYWRlIGV2ZW50IGNvbnRleHQuXG4qL1xuICByZXN1bHQub251cGdyYWRlbmVlZGVkID0gZnVuY3Rpb24gKGV2OiBJREJWZXJzaW9uQ2hhbmdlRXZlbnQpIHtcbiAgICBjb25zdCBkYiA9IChldi50YXJnZXQgYXMgSURCT3BlbkRCUmVxdWVzdCkucmVzdWx0O1xuICAgIGNvbnN0IHByZXZpb3VzU3RvcmVzID0gQXJyYXkuZnJvbShkYi5vYmplY3RTdG9yZU5hbWVzKTtcblxuICAgIC8vIGNvbnN0IGRlbGV0ZXMgPSBwcmV2aW91c1N0b3Jlcy5maWx0ZXIoeCA9PiAhcmVnaXN0cmF0aW9uLnN0b3Jlcy5pbmNsdWRlcyh4KSk7XG4gICAgLy8gY29uc3QgY3JlYXRlcyA9IHJlZ2lzdHJhdGlvbi5zdG9yZXMuZmlsdGVyKHggPT4gIXByZXZpb3VzU3RvcmVzLmluY2x1ZGVzKHgpKTtcbiAgICAvLyBqdXN0IGJsb3cgZXZlcnl0aGluZyBhd2F5IGZvciBub3dcbiAgICBwcmV2aW91c1N0b3Jlcy5mb3JFYWNoKHggPT4gZGIuZGVsZXRlT2JqZWN0U3RvcmUoeCkpO1xuICAgIHJlZ2lzdHJhdGlvbi5zdG9yZXMuZm9yRWFjaCh4ID0+IGRiLmNyZWF0ZU9iamVjdFN0b3JlKHgpKTtcbiAgfTtcbn0pO1xuIl19