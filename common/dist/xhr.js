import { defined } from './common';
export const jsonHeader = {
    Accept: 'application/vnd.lichess.v5+json',
};
export const defaultInit = {
    cache: 'no-cache',
    credentials: 'same-origin', // required for safari < 12
};
export const xhrHeader = {
    'X-Requested-With': 'XMLHttpRequest', // so lila knows it's XHR
};
export const ensureOk = (res) => {
    if (res.ok)
        return res;
    if (res.status == 429)
        throw new Error('Too many requests');
    if (res.status == 413)
        throw new Error('The uploaded file is too large');
    throw new Error(`Error ${res.status}`);
};
/* fetch a JSON value */
export const json = (url, init = {}) => jsonAnyResponse(url, init).then(res => ensureOk(res).json());
export const jsonAnyResponse = (url, init = {}) => fetch(url, {
    ...defaultInit,
    headers: {
        ...jsonHeader,
        ...xhrHeader,
    },
    ...init,
});
/* fetch a string */
export const text = (url, init = {}) => textRaw(url, init).then(res => ensureOk(res).text());
export const textRaw = (url, init = {}) => fetch(url, {
    ...defaultInit,
    headers: { ...xhrHeader },
    ...init,
});
/* load a remote script */
export const script = (src) => new Promise((resolve, reject) => {
    const nonce = document.body.getAttribute('data-nonce'), el = document.createElement('script');
    if (nonce)
        el.setAttribute('nonce', nonce);
    el.onload = resolve;
    el.onerror = reject;
    el.src = src;
    document.head.append(el);
});
/* produce HTTP form data from a JS object */
export const form = (data) => {
    const formData = new FormData();
    for (const k of Object.keys(data))
        if (defined(data[k]))
            formData.append(k, data[k]);
    return formData;
};
/* constructs a url with escaped parameters */
export const url = (path, params) => {
    const searchParams = new URLSearchParams();
    for (const k of Object.keys(params))
        if (defined(params[k]))
            searchParams.append(k, params[k]);
    const query = searchParams.toString();
    return query ? `${path}?${query}` : path;
};
/* submit a form with XHR */
export const formToXhr = (el, submitter) => {
    const action = el.getAttribute('action');
    const body = new FormData(el);
    if ((submitter === null || submitter === void 0 ? void 0 : submitter.name) && (submitter === null || submitter === void 0 ? void 0 : submitter.value)) {
        body.set(submitter.name, submitter.value);
    }
    return action
        ? text(action, {
            method: el.method,
            body,
        })
        : Promise.reject(`Form has no action: ${el}`);
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoieGhyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc3JjL3hoci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU0sVUFBVSxDQUFDO0FBRW5DLE1BQU0sQ0FBQyxNQUFNLFVBQVUsR0FBRztJQUN4QixNQUFNLEVBQUUsaUNBQWlDO0NBQzFDLENBQUM7QUFFRixNQUFNLENBQUMsTUFBTSxXQUFXLEdBQWdCO0lBQ3RDLEtBQUssRUFBRSxVQUFVO0lBQ2pCLFdBQVcsRUFBRSxhQUFhLEVBQUUsMkJBQTJCO0NBQ3hELENBQUM7QUFFRixNQUFNLENBQUMsTUFBTSxTQUFTLEdBQUc7SUFDdkIsa0JBQWtCLEVBQUUsZ0JBQWdCLEVBQUUseUJBQXlCO0NBQ2hFLENBQUM7QUFFRixNQUFNLENBQUMsTUFBTSxRQUFRLEdBQUcsQ0FBQyxHQUFhLEVBQVksRUFBRTtJQUNsRCxJQUFJLEdBQUcsQ0FBQyxFQUFFO1FBQUUsT0FBTyxHQUFHLENBQUM7SUFDdkIsSUFBSSxHQUFHLENBQUMsTUFBTSxJQUFJLEdBQUc7UUFBRSxNQUFNLElBQUksS0FBSyxDQUFDLG1CQUFtQixDQUFDLENBQUM7SUFDNUQsSUFBSSxHQUFHLENBQUMsTUFBTSxJQUFJLEdBQUc7UUFBRSxNQUFNLElBQUksS0FBSyxDQUFDLGdDQUFnQyxDQUFDLENBQUM7SUFDekUsTUFBTSxJQUFJLEtBQUssQ0FBQyxTQUFTLEdBQUcsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxDQUFDO0FBQ3pDLENBQUMsQ0FBQztBQUVGLHdCQUF3QjtBQUN4QixNQUFNLENBQUMsTUFBTSxJQUFJLEdBQUcsQ0FBQyxHQUFXLEVBQUUsT0FBb0IsRUFBRSxFQUFnQixFQUFFLENBQ3hFLGVBQWUsQ0FBQyxHQUFHLEVBQUUsSUFBSSxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksRUFBRSxDQUFDLENBQUM7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UyxHQUFHLENBQUMsRUFBbUIsRUFBRSxTQUE2QixFQUFtQixFQUFFO0lBQy9GLE1BQU0sTUFBTSxHQUFHLEVBQUUsQ0FBQyxZQUFZLENBQUMsUUFBUSxDQUFDLENBQUM7SUFDekMsTUFBTSxJQUFJLEdBQUcsSUFBSSxRQUFRLENBQUMsRUFBRSxDQUFDLENBQUM7SUFDOUIsSUFBSSxDQUFBLFNBQVMsYUFBVCxTQUFTLHVCQUFULFNBQVMsQ0FBRSxJQUFJLE1BQUksU0FBUyxhQUFULFNBQVMsdUJBQVQsU0FBUyxDQUFFLEtBQUssQ0FBQSxFQUFFO1FBQ3ZDLElBQUksQ0FBQyxHQUFHLENBQUMsU0FBUyxDQUFDLElBQUksRUFBRSxTQUFTLENBQUMsS0FBSyxDQUFDLENBQUM7S0FDM0M7SUFDRCxPQUFPLE1BQU07UUFDWCxDQUFDLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRTtZQUNYLE1BQU0sRUFBRSxFQUFFLENBQUMsTUFBTTtZQUNqQixJQUFJO1NBQ0wsQ0FBQztRQUNKLENBQUMsQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLHVCQUF1QixFQUFFLEVBQUUsQ0FBQyxDQUFDO0FBQ2xELENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGRlZmluZWQgfSBmcm9tICcuL2NvbW1vbic7XG5cbmV4cG9ydCBjb25zdCBqc29uSGVhZGVyID0ge1xuICBBY2NlcHQ6ICdhcHBsaWNhdGlvbi92bmQubGljaGVzcy52NStqc29uJyxcbn07XG5cbmV4cG9ydCBjb25zdCBkZWZhdWx0SW5pdDogUmVxdWVzdEluaXQgPSB7XG4gIGNhY2hlOiAnbm8tY2FjaGUnLFxuICBjcmVkZW50aWFsczogJ3NhbWUtb3JpZ2luJywgLy8gcmVxdWlyZWQgZm9yIHNhZmFyaSA8IDEyXG59O1xuXG5leHBvcnQgY29uc3QgeGhySGVhZGVyID0ge1xuICAnWC1SZXF1ZXN0ZWQtV2l0aCc6ICdYTUxIdHRwUmVxdWVzdCcsIC8vIHNvIGxpbGEga25vd3MgaXQncyBYSFJcbn07XG5cbmV4cG9ydCBjb25zdCBlbnN1cmVPayA9IChyZXM6IFJlc3BvbnNlKTogUmVzcG9uc2UgPT4ge1xuICBpZiAocmVzLm9rKSByZXR1cm4gcmVzO1xuICBpZiAocmVzLnN0YXR1cyA9PSA0MjkpIHRocm93IG5ldyBFcnJvcignVG9vIG1hbnkgcmVxdWVzdHMnKTtcbiAgaWYgKHJlcy5zdGF0dXMgPT0gNDEzKSB0aHJvdyBuZXcgRXJyb3IoJ1RoZSB1cGxvYWRlZCBmaWxlIGlzIHRvbyBsYXJnZScpO1xuICB0aHJvdyBuZXcgRXJyb3IoYEVycm9yICR7cmVzLnN0YXR1c31gKTtcbn07XG5cbi8qIGZldGNoIGEgSlNPTiB2YWx1ZSAqL1xuZXhwb3J0IGNvbnN0IGpzb24gPSAodXJsOiBzdHJpbmcsIGluaXQ6IFJlcXVlc3RJbml0ID0ge30pOiBQcm9taXNlPGFueT4gPT5cbiAganNvbkFueVJlc3BvbnNlKHVybCwgaW5pdCkudGhlbihyZXMgPT4gZW5zdXJlT2socmVzKS5qc29uKCkpO1xuXG5leHBvcnQgY29uc3QganNvbkFueVJlc3BvbnNlID0gKHVybDogc3RyaW5nLCBpbml0OiBSZXF1ZXN0SW5pdCA9IHt9KTogUHJvbWlzZTxhbnk+ID0+XG4gIGZldGNoKHVybCwge1xuICAgIC4uLmRlZmF1bHRJbml0LFxuICAgIGhlYWRlcnM6IHtcbiAgICAgIC4uLmpzb25IZWFkZXIsXG4gICAgICAuLi54aHJIZWFkZXIsXG4gICAgfSxcbiAgICAuLi5pbml0LFxuICB9KTtcblxuLyogZmV0Y2ggYSBzdHJpbmcgKi9cbmV4cG9ydCBjb25zdCB0ZXh0ID0gKHVybDogc3RyaW5nLCBpbml0OiBSZXF1ZXN0SW5pdCA9IHt9KTogUHJvbWlzZTxzdHJpbmc+ID0+XG4gIHRleHRSYXcodXJsLCBpbml0KS50aGVuKHJlcyA9PiBlbnN1cmVPayhyZXMpLnRleHQoKSk7XG5cbmV4cG9ydCBjb25zdCB0ZXh0UmF3ID0gKHVybDogc3RyaW5nLCBpbml0OiBSZXF1ZXN0SW5pdCA9IHt9KTogUHJvbWlzZTxSZXNwb25zZT4gPT5cbiAgZmV0Y2godXJsLCB7XG4gICAgLi4uZGVmYXVsdEluaXQsXG4gICAgaGVhZGVyczogeyAuLi54aHJIZWFkZXIgfSxcbiAgICAuLi5pbml0LFxuICB9KTtcblxuLyogbG9hZCBhIHJlbW90ZSBzY3JpcHQgKi9cbmV4cG9ydCBjb25zdCBzY3JpcHQgPSAoc3JjOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+ID0+XG4gIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICBjb25zdCBub25jZSA9IGRvY3VtZW50LmJvZHkuZ2V0QXR0cmlidXRlKCdkYXRhLW5vbmNlJyksXG4gICAgICBlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NjcmlwdCcpO1xuICAgIGlmIChub25jZSkgZWwuc2V0QXR0cmlidXRlKCdub25jZScsIG5vbmNlKTtcbiAgICBlbC5vbmxvYWQgPSByZXNvbHZlIGFzICgpID0+IHZvaWQ7XG4gICAgZWwub25lcnJvciA9IHJlamVjdDtcbiAgICBlbC5zcmMgPSBzcmM7XG4gICAgZG9jdW1lbnQuaGVhZC5hcHBlbmQoZWwpO1xuICB9KTtcblxuLyogcHJvZHVjZSBIVFRQIGZvcm0gZGF0YSBmcm9tIGEgSlMgb2JqZWN0ICovXG5leHBvcnQgY29uc3QgZm9ybSA9IChkYXRhOiBhbnkpOiBGb3JtRGF0YSA9PiB7XG4gIGNvbnN0IGZvcm1EYXRhID0gbmV3IEZvcm1EYXRhKCk7XG4gIGZvciAoY29uc3QgayBvZiBPYmplY3Qua2V5cyhkYXRhKSkgaWYgKGRlZmluZWQoZGF0YVtrXSkpIGZvcm1EYXRhLmFwcGVuZChrLCBkYXRhW2tdKTtcbiAgcmV0dXJuIGZvcm1EYXRhO1xufTtcblxuLyogY29uc3RydWN0cyBhIHVybCB3aXRoIGVzY2FwZWQgcGFyYW1ldGVycyAqL1xuZXhwb3J0IGNvbnN0IHVybCA9IChwYXRoOiBzdHJpbmcsIHBhcmFtczogeyBbazogc3RyaW5nXTogc3RyaW5nIHwgbnVtYmVyIHwgYm9vbGVhbiB8IHVuZGVmaW5lZCB9KSA9PiB7XG4gIGNvbnN0IHNlYXJjaFBhcmFtcyA9IG5ldyBVUkxTZWFyY2hQYXJhbXMoKTtcbiAgZm9yIChjb25zdCBrIG9mIE9iamVjdC5rZXlzKHBhcmFtcykpIGlmIChkZWZpbmVkKHBhcmFtc1trXSkpIHNlYXJjaFBhcmFtcy5hcHBlbmQoaywgcGFyYW1zW2tdIGFzIHN0cmluZyk7XG4gIGNvbnN0IHF1ZXJ5ID0gc2VhcmNoUGFyYW1zLnRvU3RyaW5nKCk7XG4gIHJldHVybiBxdWVyeSA/IGAke3BhdGh9PyR7cXVlcnl9YCA6IHBhdGg7XG59O1xuXG4vKiBzdWJtaXQgYSBmb3JtIHdpdGggWEhSICovXG5leHBvcnQgY29uc3QgZm9ybVRvWGhyID0gKGVsOiBIVE1MRm9ybUVsZW1lbnQsIHN1Ym1pdHRlcj86IEhUTUxCdXR0b25FbGVtZW50KTogUHJvbWlzZTxzdHJpbmc+ID0+IHtcbiAgY29uc3QgYWN0aW9uID0gZWwuZ2V0QXR0cmlidXRlKCdhY3Rpb24nKTtcbiAgY29uc3QgYm9keSA9IG5ldyBGb3JtRGF0YShlbCk7XG4gIGlmIChzdWJtaXR0ZXI/Lm5hbWUgJiYgc3VibWl0dGVyPy52YWx1ZSkge1xuICAgIGJvZHkuc2V0KHN1Ym1pdHRlci5uYW1lLCBzdWJtaXR0ZXIudmFsdWUpO1xuICB9XG4gIHJldHVybiBhY3Rpb25cbiAgICA/IHRleHQoYWN0aW9uLCB7XG4gICAgICAgIG1ldGhvZDogZWwubWV0aG9kLFxuICAgICAgICBib2R5LFxuICAgICAgfSlcbiAgICA6IFByb21pc2UucmVqZWN0KGBGb3JtIGhhcyBubyBhY3Rpb246ICR7ZWx9YCk7XG59O1xuIl19