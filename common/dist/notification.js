let notifications = [];
let listening = false;
function listenToFocus() {
    if (!listening) {
        listening = true;
        window.addEventListener('focus', () => {
            notifications.forEach(n => n.close());
            notifications = [];
        });
    }
}
function notify(msg) {
    const storage = lichess.storage.make('just-notified');
    if (document.hasFocus() || Date.now() - parseInt(storage.get(), 10) < 1000)
        return;
    storage.set('' + Date.now());
    if ($.isFunction(msg))
        msg = msg();
    const notification = new Notification('lichess.org', {
        icon: lichess.assetUrl('logo/lichess-favicon-256.png', { noVersion: true }),
        body: msg,
    });
    notification.onclick = () => window.focus();
    notifications.push(notification);
    listenToFocus();
}
export default function (msg) {
    if (document.hasFocus() || !('Notification' in window))
        return;
    if (Notification.permission === 'granted') {
        // increase chances that the first tab can put a local storage lock
        setTimeout(notify, 10 + Math.random() * 500, msg);
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibm90aWZpY2F0aW9uLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc3JjL25vdGlmaWNhdGlvbi50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxJQUFJLGFBQWEsR0FBd0IsRUFBRSxDQUFDO0FBQzVDLElBQUksU0FBUyxHQUFHLEtBQUssQ0FBQztBQUV0QixTQUFTLGFBQWE7SUFDcEIsSUFBSSxDQUFDLFNBQVMsRUFBRTtRQUNkLFNBQVMsR0FBRyxJQUFJLENBQUM7UUFDakIsTUFBTSxDQUFDLGdCQUFnQixDQUFDLE9BQU8sRUFBRSxHQUFHLEVBQUU7WUFDcEMsYUFBYSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxLQUFLLEVBQUUsQ0FBQyxDQUFDO1lBQ3RDLGFBQWEsR0FBRyxFQUFFLENBQUM7UUFDckIsQ0FBQyxDQUFDLENBQUM7S0FDSjtBQUNILENBQUM7QUFFRCxTQUFTLE1BQU0sQ0FBQyxHQUE0QjtJQUMxQyxNQUFNLE9BQU8sR0FBRyxPQUFPLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxlQUFlLENBQUMsQ0FBQztJQUN0RCxJQUFJLFFBQVEsQ0FBQyxRQUFRLEVBQUUsSUFBSSxJQUFJLENBQUMsR0FBRyxFQUFFLEdBQUcsUUFBUSxDQUFDLE9BQU8sQ0FBQyxHQUFHLEVBQUcsRUFBRSxFQUFFLENBQUMsR0FBRyxJQUFJO1FBQUUsT0FBTztJQUNwRixPQUFPLENBQUMsR0FBRyxDQUFDLEVBQUUsR0FBRyxJQUFJLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQztJQUM3QixJQUFJLENBQUMsQ0FBQyxVQUFVLENBQUMsR0FBRyxDQUFDO1FBQUUsR0FBRyxHQUFHLEdBQUcsRUFBRSxDQUFDO0lBQ25DLE1BQU0sWUFBWSxHQUFHLElBQUksWUFBWSxDQUFDLGFBQWEsRUFBRTtRQUNuRCxJQUFJLEVBQUUsT0FBTyxDQUFDLFFBQVEsQ0FBQyw4QkFBOEIsRUFBRSxFQUFFLFNBQVMsRUFBRSxJQUFJLEVBQUUsQ0FBQztRQUMzRSxJQUFJLEVBQUUsR0FBRztLQUNWLENBQUMsQ0FBQztJQUNILFlBQVksQ0FBQyxPQUFPLEdBQUcsR0FBRyxFQUFFLENBQUMsTUFBTSxDQUFDLEtBQUssRUFBRSxDQUFDO0lBQzVDLGFBQWEsQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLENBQUM7SUFDakMsYUFBYSxFQUFFLENBQUM7QUFDbEIsQ0FBQztBQUVELE1BQU0sQ0FBQyxPQUFPLFdBQVcsR0FBNEI7SUFDbkQsSUFBSSxRQUFRLENBQUMsUUFBUSxFQUFFLElBQUksQ0FBQyxDQUFDLGNBQWMsSUFBSSxNQUFNLENBQUM7UUFBRSxPQUFPO0lBQy9ELElBQUksWUFBWSxDQUFDLFVBQVUsS0FBSyxTQUFTLEVBQUU7UUFDekMsbUVBQW1FO1FBQ25FLFVBQVUsQ0FBQyxNQUFNLEVBQUUsRUFBRSxHQUFHLElBQUksQ0FBQyxNQUFNLEVBQUUsR0FBRyxHQUFHLEVBQUUsR0FBRyxDQUFDLENBQUM7S0FDbkQ7QUFDSCxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsibGV0IG5vdGlmaWNhdGlvbnM6IEFycmF5PE5vdGlmaWNhdGlvbj4gPSBbXTtcbmxldCBsaXN0ZW5pbmcgPSBmYWxzZTtcblxuZnVuY3Rpb24gbGlzdGVuVG9Gb2N1cygpIHtcbiAgaWYgKCFsaXN0ZW5pbmcpIHtcbiAgICBsaXN0ZW5pbmcgPSB0cnVlO1xuICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdmb2N1cycsICgpID0+IHtcbiAgICAgIG5vdGlmaWNhdGlvbnMuZm9yRWFjaChuID0+IG4uY2xvc2UoKSk7XG4gICAgICBub3RpZmljYXRpb25zID0gW107XG4gICAgfSk7XG4gIH1cbn1cblxuZnVuY3Rpb24gbm90aWZ5KG1zZzogc3RyaW5nIHwgKCgpID0+IHN0cmluZykpIHtcbiAgY29uc3Qgc3RvcmFnZSA9IGxpY2hlc3Muc3RvcmFnZS5tYWtlKCdqdXN0LW5vdGlmaWVkJyk7XG4gIGlmIChkb2N1bWVudC5oYXNGb2N1cygpIHx8IERhdGUubm93KCkgLSBwYXJzZUludChzdG9yYWdlLmdldCgpISwgMTApIDwgMTAwMCkgcmV0dXJuO1xuICBzdG9yYWdlLnNldCgnJyArIERhdGUubm93KCkpO1xuICBpZiAoJC5pc0Z1bmN0aW9uKG1zZykpIG1zZyA9IG1zZygpO1xuICBjb25zdCBub3RpZmljYXRpb24gPSBuZXcgTm90aWZpY2F0aW9uKCdsaWNoZXNzLm9yZycsIHtcbiAgICBpY29uOiBsaWNoZXNzLmFzc2V0VXJsKCdsb2dvL2xpY2hlc3MtZmF2aWNvbi0yNTYucG5nJywgeyBub1ZlcnNpb246IHRydWUgfSksXG4gICAgYm9keTogbXNnLFxuICB9KTtcbiAgbm90aWZpY2F0aW9uLm9uY2xpY2sgPSAoKSA9PiB3aW5kb3cuZm9jdXMoKTtcbiAgbm90aWZpY2F0aW9ucy5wdXNoKG5vdGlmaWNhdGlvbik7XG4gIGxpc3RlblRvRm9jdXMoKTtcbn1cblxuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gKG1zZzogc3RyaW5nIHwgKCgpID0+IHN0cmluZykpIHtcbiAgaWYgKGRvY3VtZW50Lmhhc0ZvY3VzKCkgfHwgISgnTm90aWZpY2F0aW9uJyBpbiB3aW5kb3cpKSByZXR1cm47XG4gIGlmIChOb3RpZmljYXRpb24ucGVybWlzc2lvbiA9PT0gJ2dyYW50ZWQnKSB7XG4gICAgLy8gaW5jcmVhc2UgY2hhbmNlcyB0aGF0IHRoZSBmaXJzdCB0YWIgY2FuIHB1dCBhIGxvY2FsIHN0b3JhZ2UgbG9ja1xuICAgIHNldFRpbWVvdXQobm90aWZ5LCAxMCArIE1hdGgucmFuZG9tKCkgKiA1MDAsIG1zZyk7XG4gIH1cbn1cbiJdfQ==