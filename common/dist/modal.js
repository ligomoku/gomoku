import { h } from 'snabbdom';
import { bind, onInsert } from './snabbdom';
export default function modal(opts) {
    modal.close();
    const $wrap = $('<div id="modal-wrap"><span class="close" role="button" aria-label="Close" data-icon="" tabindex="0"></span></div>');
    const $overlay = $(`<div id="modal-overlay" class="${opts.class}">`);
    if (!opts.noClickAway)
        $overlay.on('click', modal.close);
    $('<a href="#"></a>').appendTo($overlay); // guard against focus escaping to window chrome
    $wrap.appendTo($overlay);
    $('<a href="#"></a>').appendTo($overlay); // guard against focus escaping to window chrome
    opts.content.clone().removeClass('none').appendTo($wrap);
    opts.onInsert && opts.onInsert($wrap);
    modal.onClose = opts.onClose;
    $wrap.find('.close,.cancel').each(function () {
        bindClose(this, modal.close);
    });
    $('body').addClass('overlayed').prepend($overlay);
    bindWrap($wrap);
    return $wrap;
}
modal.close = () => {
    $('body').removeClass('overlayed');
    $('#modal-overlay').each(function () {
        if (modal.onClose)
            modal.onClose();
        $(this).remove();
    });
    delete modal.onClose;
};
modal.onClose = undefined;
export function snabModal(opts) {
    const close = opts.onClose;
    return h('div#modal-overlay', opts.noClickAway ? {} : { hook: bind('click', close) }, [
        h('div#modal-wrap.' + opts.class, {
            hook: onInsert(el => {
                bindWrap($(el));
                opts.onInsert && opts.onInsert($(el));
            }),
        }, [
            h('span.close', {
                attrs: {
                    'data-icon': '',
                    role: 'button',
                    'aria-label': 'Close',
                    tabindex: '0',
                },
                hook: onInsert(el => bindClose(el, close)),
            }),
            h('div', opts.content),
        ]),
    ]);
}
const bindClose = (el, close) => {
    el.addEventListener('click', close);
    el.addEventListener('keydown', e => (e.code === 'Enter' || e.code === 'Space' ? close() : true));
};
const bindWrap = ($wrap) => {
    $wrap.on('click', (e) => e.stopPropagation());
    focusFirstChild($wrap);
};
const focusableSelectors = 'button:not(:disabled), [href], input:not(:disabled):not([type="hidden"]), select:not(:disabled), textarea:not(:disabled), [tabindex="0"]';
export function trapFocus(event) {
    var _a;
    const wrap = $('#modal-wrap')[0];
    if (!wrap)
        return;
    const position = wrap.compareDocumentPosition(event.target);
    if (position & Node.DOCUMENT_POSITION_CONTAINED_BY)
        return;
    const focusableChildren = $(wrap).find(focusableSelectors);
    const index = position & Node.DOCUMENT_POSITION_FOLLOWING ? 0 : focusableChildren.length - 1;
    (_a = focusableChildren.get(index)) === null || _a === void 0 ? void 0 : _a.focus();
    event.preventDefault();
}
export const focusFirstChild = (parent) => {
    const children = parent.find(focusableSelectors);
    // prefer child 1 over child 0 because child 0 should be a close button
    // use setTimeout to avoid race conditions with snabbdom
    setTimeout(() => { var _a, _b; return (_b = ((_a = children[1]) !== null && _a !== void 0 ? _a : children[0])) === null || _b === void 0 ? void 0 : _b.focus(); });
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibW9kYWwuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi9zcmMvbW9kYWwudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLENBQUMsRUFBUyxNQUFNLFVBQVUsQ0FBQztBQUNwQyxPQUFPLEVBQUUsSUFBSSxFQUFlLFFBQVEsRUFBRSxNQUFNLFlBQVksQ0FBQztBQWtCekQsTUFBTSxDQUFDLE9BQU8sVUFBVSxLQUFLLENBQUMsSUFBVztJQUN2QyxLQUFLLENBQUMsS0FBSyxFQUFFLENBQUM7SUFDZCxNQUFNLEtBQUssR0FBRyxDQUFDLENBQ2Isb0hBQW9ILENBQ3JILENBQUM7SUFDRixNQUFNLFFBQVEsR0FBRyxDQUFDLENBQUMsa0NBQWtDLElBQUksQ0FBQyxLQUFLLElBQUksQ0FBQyxDQUFDO0lBQ3JFLElBQUksQ0FBQyxJQUFJLENBQUMsV0FBVztRQUFFLFFBQVEsQ0FBQyxFQUFFLENBQUMsT0FBTyxFQUFFLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUN6RCxDQUFDLENBQUMsa0JBQWtCLENBQUMsQ0FBQyxRQUFRLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxnREFBZ0Q7SUFDMUYsS0FBSyxDQUFDLFFBQVEsQ0FBQyxRQUFRLENBQUMsQ0FBQztJQUN6QixDQUFDLENBQUMsa0JBQWtCLENBQUMsQ0FBQyxRQUFRLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxnREFBZ0Q7SUFDMUYsSUFBSSxDQUFDLE9BQU8sQ0FBQyxLQUFLLEVBQUUsQ0FBQyxXQUFXLENBQUMsTUFBTSxDQUFDLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQ3pELElBQUksQ0FBQyxRQUFRLElBQUksSUFBSSxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUN0QyxLQUFLLENBQUMsT0FBTyxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUM7SUFDN0IsS0FBSyxDQUFDLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDLElBQUksQ0FB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b20nO1xuaW1wb3J0IHsgYmluZCwgTWF5YmVWTm9kZXMsIG9uSW5zZXJ0IH0gZnJvbSAnLi9zbmFiYmRvbSc7XG5cbmludGVyZmFjZSBCYXNlTW9kYWwge1xuICBjbGFzcz86IHN0cmluZztcbiAgb25JbnNlcnQ/OiAoJHdyYXA6IENhc2gpID0+IHZvaWQ7XG4gIG9uQ2xvc2U/KCk6IHZvaWQ7XG4gIG5vQ2xpY2tBd2F5PzogYm9vbGVhbjtcbn1cblxuaW50ZXJmYWNlIE1vZGFsIGV4dGVuZHMgQmFzZU1vZGFsIHtcbiAgY29udGVudDogQ2FzaDtcbn1cblxuaW50ZXJmYWNlIFNuYWJNb2RhbCBleHRlbmRzIEJhc2VNb2RhbCB7XG4gIGNvbnRlbnQ6IE1heWJlVk5vZGVzO1xuICBvbkNsb3NlKCk6IHZvaWQ7XG59XG5cbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIG1vZGFsKG9wdHM6IE1vZGFsKSB7XG4gIG1vZGFsLmNsb3NlKCk7XG4gIGNvbnN0ICR3cmFwID0gJChcbiAgICAnPGRpdiBpZD1cIm1vZGFsLXdyYXBcIj48c3BhbiBjbGFzcz1cImNsb3NlXCIgcm9sZT1cImJ1dHRvblwiIGFyaWEtbGFiZWw9XCJDbG9zZVwiIGRhdGEtaWNvbj1cIu6Av1wiIHRhYmluZGV4PVwiMFwiPjwvc3Bhbj48L2Rpdj4nXG4gICk7XG4gIGNvbnN0ICRvdmVybGF5ID0gJChgPGRpdiBpZD1cIm1vZGFsLW92ZXJsYXlcIiBjbGFzcz1cIiR7b3B0cy5jbGFzc31cIj5gKTtcbiAgaWYgKCFvcHRzLm5vQ2xpY2tBd2F5KSAkb3ZlcmxheS5vbignY2xpY2snLCBtb2RhbC5jbG9zZSk7XG4gICQoJzxhIGhyZWY9XCIjXCI+PC9hPicpLmFwcGVuZFRvKCRvdmVybGF5KTsgLy8gZ3VhcmQgYWdhaW5zdCBmb2N1cyBlc2NhcGluZyB0byB3aW5kb3cgY2hyb21lXG4gICR3cmFwLmFwcGVuZFRvKCRvdmVybGF5KTtcbiAgJCgnPGEgaHJlZj1cIiNcIj48L2E+JykuYXBwZW5kVG8oJG92ZXJsYXkpOyAvLyBndWFyZCBhZ2FpbnN0IGZvY3VzIGVzY2FwaW5nIHRvIHdpbmRvdyBjaHJvbWVcbiAgb3B0cy5jb250ZW50LmNsb25lKCkucmVtb3ZlQ2xhc3MoJ25vbmUnKS5hcHBlbmRUbygkd3JhcCk7XG4gIG9wdHMub25JbnNlcnQgJiYgb3B0cy5vbkluc2VydCgkd3JhcCk7XG4gIG1vZGFsLm9uQ2xvc2UgPSBvcHRzLm9uQ2xvc2U7XG4gICR3cmFwLmZpbmQoJy5jbG9zZSwuY2FuY2VsJykuZWFjaChmdW5jdGlvbiAodGhpczogSFRNTEVsZW1lbnQpIHtcbiAgICBiaW5kQ2xvc2UodGhpcywgbW9kYWwuY2xvc2UpO1xuICB9KTtcbiAgJCgnYm9keScpLmFkZENsYXNzKCdvdmVybGF5ZWQnKS5wcmVwZW5kKCRvdmVybGF5KTtcbiAgYmluZFdyYXAoJHdyYXApO1xuICByZXR1cm4gJHdyYXA7XG59XG5cbm1vZGFsLmNsb3NlID0gKCkgPT4ge1xuICAkKCdib2R5JykucmVtb3ZlQ2xhc3MoJ292ZXJsYXllZCcpO1xuICAkKCcjbW9kYWwtb3ZlcmxheScpLmVhY2goZnVuY3Rpb24gKHRoaXM6IEhUTUxFbGVtZW50KSB7XG4gICAgaWYgKG1vZGFsLm9uQ2xvc2UpIG1vZGFsLm9uQ2xvc2UoKTtcbiAgICAkKHRoaXMpLnJlbW92ZSgpO1xuICB9KTtcbiAgZGVsZXRlIG1vZGFsLm9uQ2xvc2U7XG59O1xuXG5tb2RhbC5vbkNsb3NlID0gdW5kZWZpbmVkIGFzICgoKSA9PiB2b2lkKSB8IHVuZGVmaW5lZDtcblxuZXhwb3J0IGZ1bmN0aW9uIHNuYWJNb2RhbChvcHRzOiBTbmFiTW9kYWwpOiBWTm9kZSB7XG4gIGNvbnN0IGNsb3NlID0gb3B0cy5vbkNsb3NlITtcbiAgcmV0dXJuIGgoJ2RpdiNtb2RhbC1vdmVybGF5Jywgb3B0cy5ub0NsaWNrQXdheSA/IHt9IDogeyBob29rOiBiaW5kKCdjbGljaycsIGNsb3NlKSB9LCBbXG4gICAgaChcbiAgICAgICdkaXYjbW9kYWwtd3JhcC4nICsgb3B0cy5jbGFzcyxcbiAgICAgIHtcbiAgICAgICAgaG9vazogb25JbnNlcnQoZWwgPT4ge1xuICAgICAgICAgIGJpbmRXcmFwKCQoZWwpKTtcbiAgICAgICAgICBvcHRzLm9uSW5zZXJ0ICYmIG9wdHMub25JbnNlcnQoJChlbCkpO1xuICAgICAgICB9KSxcbiAgICAgIH0sXG4gICAgICBbXG4gICAgICAgIGgoJ3NwYW4uY2xvc2UnLCB7XG4gICAgICAgICAgYXR0cnM6IHtcbiAgICAgICAgICAgICdkYXRhLWljb24nOiAn7oC/JyxcbiAgICAgICAgICAgIHJvbGU6ICdidXR0b24nLFxuICAgICAgICAgICAgJ2FyaWEtbGFiZWwnOiAnQ2xvc2UnLFxuICAgICAgICAgICAgdGFiaW5kZXg6ICcwJyxcbiAgICAgICAgICB9LFxuICAgICAgICAgIGhvb2s6IG9uSW5zZXJ0KGVsID0+IGJpbmRDbG9zZShlbCwgY2xvc2UpKSxcbiAgICAgICAgfSksXG4gICAgICAgIGgoJ2RpdicsIG9wdHMuY29udGVudCksXG4gICAgICBdXG4gICAgKSxcbiAgXSk7XG59XG5cbmNvbnN0IGJpbmRDbG9zZSA9IChlbDogSFRNTEVsZW1lbnQsIGNsb3NlOiAoKSA9PiB2b2lkKSA9PiB7XG4gIGVsLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgY2xvc2UpO1xuICBlbC5hZGRFdmVudExpc3RlbmVyKCdrZXlkb3duJywgZSA9PiAoZS5jb2RlID09PSAnRW50ZXInIHx8IGUuY29kZSA9PT0gJ1NwYWNlJyA/IGNsb3NlKCkgOiB0cnVlKSk7XG59O1xuXG5jb25zdCBiaW5kV3JhcCA9ICgkd3JhcDogQ2FzaCkgPT4ge1xuICAkd3JhcC5vbignY2xpY2snLCAoZTogRXZlbnQpID0+IGUuc3RvcFByb3BhZ2F0aW9uKCkpO1xuICBmb2N1c0ZpcnN0Q2hpbGQoJHdyYXApO1xufTtcblxuY29uc3QgZm9jdXNhYmxlU2VsZWN0b3JzID1cbiAgJ2J1dHRvbjpub3QoOmRpc2FibGVkKSwgW2hyZWZdLCBpbnB1dDpub3QoOmRpc2FibGVkKTpub3QoW3R5cGU9XCJoaWRkZW5cIl0pLCBzZWxlY3Q6bm90KDpkaXNhYmxlZCksIHRleHRhcmVhOm5vdCg6ZGlzYWJsZWQpLCBbdGFiaW5kZXg9XCIwXCJdJztcblxuZXhwb3J0IGZ1bmN0aW9uIHRyYXBGb2N1cyhldmVudDogRm9jdXNFdmVudCkge1xuICBjb25zdCB3cmFwOiBIVE1MRWxlbWVudCB8IHVuZGVmaW5lZCA9ICQoJyNtb2RhbC13cmFwJylbMF07XG4gIGlmICghd3JhcCkgcmV0dXJuO1xuICBjb25zdCBwb3NpdGlvbiA9IHdyYXAuY29tcGFyZURvY3VtZW50UG9zaXRpb24oZXZlbnQudGFyZ2V0IGFzIEhUTUxFbGVtZW50KTtcbiAgaWYgKHBvc2l0aW9uICYgTm9kZS5ET0NVTUVOVF9QT1NJVElPTl9DT05UQUlORURfQlkpIHJldHVybjtcbiAgY29uc3QgZm9jdXNhYmxlQ2hpbGRyZW4gPSAkKHdyYXApLmZpbmQoZm9jdXNhYmxlU2VsZWN0b3JzKTtcbiAgY29uc3QgaW5kZXggPSBwb3NpdGlvbiAmIE5vZGUuRE9DVU1FTlRfUE9TSVRJT05fRk9MTE9XSU5HID8gMCA6IGZvY3VzYWJsZUNoaWxkcmVuLmxlbmd0aCAtIDE7XG4gIGZvY3VzYWJsZUNoaWxkcmVuLmdldChpbmRleCk/LmZvY3VzKCk7XG4gIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG59XG5cbmV4cG9ydCBjb25zdCBmb2N1c0ZpcnN0Q2hpbGQgPSAocGFyZW50OiBDYXNoKSA9PiB7XG4gIGNvbnN0IGNoaWxkcmVuID0gcGFyZW50LmZpbmQoZm9jdXNhYmxlU2VsZWN0b3JzKTtcbiAgLy8gcHJlZmVyIGNoaWxkIDEgb3ZlciBjaGlsZCAwIGJlY2F1c2UgY2hpbGQgMCBzaG91bGQgYmUgYSBjbG9zZSBidXR0b25cbiAgLy8gdXNlIHNldFRpbWVvdXQgdG8gYXZvaWQgcmFjZSBjb25kaXRpb25zIHdpdGggc25hYmJkb21cbiAgc2V0VGltZW91dCgoKSA9PiAoY2hpbGRyZW5bMV0gPz8gY2hpbGRyZW5bMF0pPy5mb2N1cygpKTtcbn07XG4iXX0=